---
// src/pages/index.astro

import { Image } from 'astro:assets';
import Layout from '../layouts/Layout.astro';
import ServiceCard from '../components/ServiceCard.astro';

// --- Importación de datos ---
import { servicesData } from '../data/servicesData.js';
import { faqData } from '../data/faqData.js';

// --- Importación de Contentful ---
import { client } from '../lib/contentful.js';
import { transformPost, type CleanPost, type ContentfulPostFields } from '../lib/contentful-utils.ts';

// --- Importación de Assets ---
import heroImage from '../assets/images/hero/smiley-jovenes-hermanos-abrazandose.webp';
import nataliaImage from '../assets/images/natalia/natalia.webp';
import selloImage from '../assets/images/sello.svg';

// --- Importación de Componentes de Sección ---
import HeroSection from '../components/sections/HeroSection.astro';
import TrustBar from '../components/sections/TrustBar.astro';
import AboutSection from '../components/sections/AboutSection.astro';
import TestimonialsSection from '../components/sections/TestimonialsSection.astro';
import FaqSection from '../components/sections/FaqSection.astro';
import ContactSection from '../components/sections/ContactSection.astro';
import AccordionCardsGrid from '../components/sections/AccordionCardsGrid.astro';

// --- Lógica de Página ---
const recaptchaSiteKey = import.meta.env.PUBLIC_RECAPTCHA_SITE_KEY;

// Obtenemos solo 3 posts para el AccordionGrid
const response = await client.getEntries({
  content_type: 'blogPost',
  limit: 3,
  order: ['-fields.publishedDate']
});

const allFields = response.items.map(item => item.fields as unknown as ContentfulPostFields);
const latestPosts: CleanPost[] = allFields.map(transformPost);
---

<Layout 
    title=""
    description="Atención psicológica online especializada en infancia, adolescencia y adultos. Terapia cognitivo-conductual, orientación para padres, asesorías judiciales y supervisión clínica. Psicóloga con más de 12 años de experiencia. Agenda tu sesión en Comprende.me."
>
    <HeroSection
        image={heroImage}
        alt="Familia feliz abrazándose"
    />

    <TrustBar />

    <section id="services" class="section bg-light">
        <div class="container text-center">
            <h2 class="section-title">
                Un acompañamiento para cada etapa de tu vida
            </h2>
            <h3>Descubre cómo podemos ayudarte a ti, a tus hijos y a tu familia a construir vínculos más fuertes y a encontrar el bienestar emocional.</h3>
            
            <div id="services-grid" class="grid grid-3-cols">
                {servicesData.map(service => (
                    <ServiceCard {...service} />
                ))}
            </div>
        </div>
    </section>

    <AboutSection 
        profileImage={nataliaImage}
        profileAlt="Natalia Beiza, Psicóloga Infantojuvenil"
        sealImage={selloImage}
        sealAlt="Sello profesional Comprende-Me"
    />

    <TestimonialsSection />

    <AccordionCardsGrid 
        posts={latestPosts}
        title="Últimos Artículos del Blog"
        subtitle="Consejos y reflexiones sobre psicología infantojuvenil y crianza"
        moreLinkHref="/blog"
        moreLinkText="Ver todos los artículos"
    />

    <FaqSection faqs={faqData} />

    <ContactSection recaptchaSiteKey={recaptchaSiteKey} />
</Layout>

<style>
    h3 {
        margin: auto;
        margin-bottom: 2rem;
    }
</style>