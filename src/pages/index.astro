---
// src/pages/index.astro

import { Image } from 'astro:assets'; // Aún lo necesitamos para las props
import Layout from '../layouts/Layout.astro';
import ServiceCard from '../components/ServiceCard.astro';
import ArticleCard from '../components/ArticleCard.astro';

// --- Importación de datos ---
import { servicesData } from '../data/servicesData.js';
import { faqData } from '../data/faqData.js';

// --- Importación de Contentful ---
import { client } from '../lib/contentful.js';
import { transformPost, type CleanPost, type ContentfulPostFields } from '../lib/contentful-utils.ts';

// --- Importación de Assets ---
import heroImage from '../assets/images/hero/smiley-jovenes-hermanos-abrazandose.webp';
import nataliaImage from '../assets/images/natalia/natalia.webp';
import selloImage from '../assets/images/sello.svg';

// --- Importación de NUEVOS Componentes de Sección ---
import HeroSection from '../components/sections/HeroSection.astro';
import TrustBar from '../components/sections/TrustBar.astro';
import AboutSection from '../components/sections/AboutSection.astro';
import TestimonialsSection from '../components/sections/TestimonialsSection.astro';
import FaqSection from '../components/sections/FaqSection.astro';
import ContactSection from '../components/sections/ContactSection.astro';


// --- Lógica de Página (sin cambios) ---
const recaptchaSiteKey = import.meta.env.PUBLIC_RECAPTCHA_SITE_KEY;
const response = await client.getEntries({
  content_type: 'blogPost',
  limit: 4,
  order: ['-fields.publishedDate']
});
const allFields = response.items.map(item => item.fields as unknown as ContentfulPostFields);
const postsToShow: CleanPost[] = allFields.map(transformPost);
---
<Layout 
    title="Comprende.me - Psicología Infanto-Juvenil Online"
    description="Un espacio seguro y transformador para que niños, adolescentes y sus familias encuentren guía y apoyo emocional con la psicóloga Natalia Beiza."
>
    
    <Fragment slot="head-extra">
        <script src=`https://www.google.com/recaptcha/api.js?render=${recaptchaSiteKey}` async defer></script>
    </Fragment>
    
    <HeroSection 
        image={heroImage} 
        alt="Jóvenes hermanos abrazándose" 
    />

    <TrustBar />
    
    <section id="services" class="section bg-light">
        <div class="container text-center">
            <h2 class="section-title">Un acompañamiento para cada etapa de tu vida</h2>
            <h3>Descubre cómo podemos ayudarte a ti, a tus hijos y a tu familia a construir vínculos más fuertes y a encontrar el bienestar emocional.</h3>
            <div id="services-grid" class="grid grid-3-cols">
                {servicesData.map(service => (
                    <ServiceCard {...service} />
                ))}
            </div>
        </div>
    </section>

    <AboutSection 
        profileImage={nataliaImage}
        profileAlt="Psicóloga Natalia Beiza Calvo"
        sealImage={selloImage}
        sealAlt="Sello de Psicóloga Registrada"
    />

    <TestimonialsSection />
    
    <section id="blog" class="section">
        <div class="container text-center">
            <h2 class="section-title">Blog y Recursos</h2>
            <h3>Artículos y reflexiones para apoyar tu camino.</h3>
            <div id="blog-grid" class="grid grid-4-cols">
                {postsToShow.map(post => (
                    <ArticleCard post={post} />
                ))}
            </div>
        </div>
    </section>

    <FaqSection faqs={faqData} />

    <ContactSection siteKey={recaptchaSiteKey} />

</Layout>