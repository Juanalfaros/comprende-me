---
// src/pages/blog/[slug].astro
import Layout from '../../layouts/Layout.astro';
import { blogData } from '../../data.js';
import ArticleCard from '../../components/ArticleCard.astro';
import AuthorBio from '../../components/AuthorBio.astro';
import SocialShare from '../../components/SocialShare.astro';

export async function getStaticPaths() {
  return blogData.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;

// Formateamos la fecha para que se vea en un formato legible (ej: "22 de septiembre de 2025")
const formattedDate = new Date(post.publishedDate).toLocaleDateString('es-CL', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    timeZone: 'UTC', // Añadimos timeZone para evitar errores de un día
});

const relatedPosts = blogData.filter(related => 
    related.slug !== post.slug &&
    related.tags.some(tag => post.tags.includes(tag))
).slice(0, 3);
---
<Layout title={`${post.title} | Comprende.me`}>
    
    <Fragment slot="head-extra">
        <link rel="stylesheet" href="/styles/article.css">
    </Fragment>

    <main>
        <section class="section">
            <div class="container container-narrow">
                <article>
                    <h1>{post.title}</h1>
                    <div class="article-meta-info" style="margin-bottom: 1.5rem; color: var(--color-muted);">
                        <time datetime={post.publishedDate}>{formattedDate}</time>
                        <span style="margin: 0 0.5rem;">•</span>
                        <span>{post.duration}</span>
                    </div>
                    
                    <img src={`${post.image}`} alt={post.alt} style="width: 100%; max-height: 450px; object-fit: cover; border-radius: 8px; margin-bottom: 2.5rem;" />
                    
                    <div class="article-body" set:html={post.fullContentHTML} />

                    <SocialShare url={Astro.url} title={post.title} />
                    <AuthorBio />
                    
                    <a href="/blog" class="back-to-blog-link" style="display: inline-block; margin-top: 3rem; font-weight: 500;">&larr; Volver a todos los artículos</a>
                </article>

                {relatedPosts.length > 0 && (
                    <section class="related-articles">
                        <h2>Artículos Relacionados</h2>
                        <div class="grid grid-3-cols">
                            {relatedPosts.map(relatedPost => (
                                <ArticleCard post={relatedPost} />
                            ))}
                        </div>
                    </section>
                )}
            </div>
        </section>
    </main>
</Layout>