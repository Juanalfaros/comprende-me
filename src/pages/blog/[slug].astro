
---
// src/pages/blog/[slug].astro

import Layout from '../../layouts/Layout.astro';
import { blogData } from '../../data.js';
import ArticleCard from '../../components/ArticleCard.astro';
import AuthorBio from '../../components/AuthorBio.astro';
import SocialShare from '../../components/SocialShare.astro';

export async function getStaticPaths() {
  return blogData.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;

// Lógica para encontrar artículos relacionados
const relatedPosts = blogData.filter(related => 
    related.slug !== post.slug && // Excluye el artículo actual
    related.tags.some(tag => post.tags.includes(tag)) // Busca etiquetas en común
).slice(0, 3); // Muestra un máximo de 3
---

<Layout title={`${post.title} | Comprende.me`}  
    description={post.excerpt}
    image={post.image}>
    
    <Fragment slot="head-extra">
        <link rel="stylesheet" href="/styles/article.css">
    </Fragment>

    <main>
        <section class="section">
            <div class="container container-narrow">
                <article>
                  <h1>{post.title}</h1>
                    <div class="article-meta-info" style="margin-bottom: 1.5rem; color: var(--color-muted);">
                        <span>{post.duration}</span>
                        {post.tags.map(tag => (
                            <span class="tag" style="background-color: var(--color-light); color: var(--color-muted); font-size: 0.8rem; padding: 0.25rem 0.75rem; border-radius: 999px; margin-left: 0.5rem;">{tag}</span>
                        ))}
                    </div>

                    <img src={`${post.image}`} alt={post.alt} style="width: 100%; max-height: 450px; object-fit: cover; border-radius: 48px; margin-bottom: 2.5rem;" />
                    
                    <div class="article-body" set:html={post.fullContentHTML} />

                    <SocialShare url={Astro.url} title={post.title} />
                    <AuthorBio />
                    
                    <a href="/blog" class="back-to-blog-link"><i class="ph ph-arrow-arc-left"></i> Volver a todos los artículos</a>
                </article>

                {relatedPosts.length > 0 && (
                    <section class="related-articles">
                        <h2>Artículos Relacionados</h2>
                        <div class="grid grid-3-cols">
                            {relatedPosts.map(relatedPost => (
                                <ArticleCard post={relatedPost} />
                            ))}
                        </div>
                    </section>
                )}
            </div>
        </section>
    </main>
</Layout>