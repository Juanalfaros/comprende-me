---
import Layout from '../../layouts/Layout.astro';
import ArticleCard from '../../components/ArticleCardBento.astro'; 
import { client } from '../../lib/contentful.js';
import { transformPost, type CleanPost, type ContentfulPostFields } from '../../lib/contentful-utils';

const response = await client.getEntries({ content_type: 'blogPost' });
const allFields = response.items.map(item => item.fields as unknown as ContentfulPostFields);

const allPosts: CleanPost[] = allFields
  .map(transformPost)
  .sort((a, b) => new Date(b.publishedDate).getTime() - new Date(a.publishedDate).getTime());

const featuredPost = allPosts[0]; // El primero y más nuevo
const otherPosts = allPosts.slice(1); // El resto
---

<Layout 
  title="Mi Blog | Nuestros Artículos"
  description="Recursos, reflexiones y herramientas para apoyar tu camino hacia el bienestar emocional y el de tu familia."
>
    
    <section class="blog-hero-section">
        <div class="container">
            <ArticleCard post={featuredPost} variant="featured" />
        </div>
    </section>

    <section class="blog-recent-section">
        <div class="container">
            <h2>Explora nuestros artículos</h2>
            
            <div class="posts-grid">
                {otherPosts.map(post => (
                    <ArticleCard post={post} variant="default" />
                ))}
            </div>
        </div>
    </section>

</Layout>

<style>

    .blog-hero-section {
        margin-top: 20px;
        padding-top: 3rem;
        padding-bottom: 3rem;
    }
    
    .blog-recent-section {
        padding-bottom: 3rem;
    }

    .blog-recent-section h2 {
        font-family: var(--font-heading);
        font-size: 1.5rem; /* 24px */
        font-weight: 600;
        color: var(--color-dark);
        margin-bottom: 2rem; /* Espacio antes de la grilla */
    }

    .posts-grid {
        display: grid;
        /* 3 columnas en desktop */
        grid-template-columns: repeat(3, 1fr);
        gap: 2rem 1.5rem; /* 32px vertical, 24px horizontal */
    }

    @media (max-width: 1024px) {
        .posts-grid {
            /* 2 columnas en tablet */
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 767px) {
        .posts-grid {
            /* 1 columna en móvil */
            grid-template-columns: 1fr;
        }
        .blog-hero-section,
        .blog-recent-section {
            padding-top: 1.5rem;
            padding-bottom: 1.5rem;
        }
        .blog-recent-section h2 {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
        }
    }
</style>