---
// src/layouts/Layout.astro
import { ViewTransitions } from "astro:transitions";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import CtaSection from "../components/CtaSection.astro";
import WhatsappButton from "../components/WhatsappButton.astro";
import CalScripts from "../components/CalScripts.astro";
import { servicesData } from "../data/servicesData.js";
import Seo from "../components/Seo.astro";
import CookieConsent from "../components/CookieConsent.astro";
import TrackingScripts from "../components/TrackingScripts.astro";

import "../styles/global.css";
import "../styles/components.css";

const gtmId = import.meta.env.PUBLIC_GTM_ID;

interface Props {
    title: string;
    description: string;
    image?: string;
}
const { title, description, image } = Astro.props;
---

<!doctype html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <Seo title={title} description={description} image={image} />

        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

        {/* --- INICIO DE LA OPTIMIZACIÓN --- */}

        {/* Pre-conexión a los dominios de las fuentes */}
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

        {
            /* 1. Pre-cargamos las fuentes más importantes para reducir el Layout Shift (CLS) */
        }
        <link
            rel="preload"
            href="https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7.woff2"
            as="font"
            type="font/woff2"
            crossorigin
        />
        <link
            rel="preload"
            href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/Phosphor.woff2"
            as="font"
            type="font/woff2"
            crossorigin
        />

        {
            /* 2. Cargamos las fuentes de forma asíncrona para que no bloqueen la renderización */
        }
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Alan+Sans:wght@400;700;800&family=Inter:wght@400;500;600&display=swap"
            media="print"
            onload="this.media='all'"
        />
        <noscript
            ><link
                rel="stylesheet"
                href="https://fonts.googleapis.com/css2?family=Alan+Sans:wght@400;700;800&family=Inter:wght@400;500;600&display=swap"
            /></noscript
        >

        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css"
            media="print"
            onload="this.media='all'"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/bold/style.css"
            media="print"
            onload="this.media='all'"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css"
            media="print"
            onload="this.media='all'"
        />
        <noscript
            ><link
                rel="stylesheet"
                href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/css/phosphor.css"
            /></noscript
        >

        {/* --- FIN DE LA OPTIMIZACIÓN --- */}

        <slot name="head-extra" />

        <TrackingScripts />
        <ViewTransitions />
    </head>
    <body>
        {
            gtmId && (
                <noscript>
                    <iframe
                        src={`https://www.googletagmanager.com/ns.html?id=${gtmId}`}
                        height="0"
                        width="0"
                        style="display:none;visibility:hidden"
                    />
                </noscript>
            )
        }

        <Header pageType="home" floatBtnTriggerSelector=".cta-section" />
        <main><slot /></main>
        <CtaSection />
        <Footer />
        <WhatsappButton />
        <CalScripts services={servicesData} />
        <CookieConsent />
    </body>
</html>
